{% assign repo_parts = include.repository | split: '/' %}
{% assign repo_owner = repo_parts[0] %}
{% assign repo_name = repo_parts[1] %}

<div class="repo-card">
  <div class="repo-card-header">
    <div class="repo-card-title-wrapper">
      <svg class="repo-icon" viewBox="0 0 16 16" width="1.2em" height="1.2em" fill="currentColor">
        <path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75A2.75 2.75 0 0 1 16 2.75v10.5A2.75 2.75 0 0 1 13.25 16h-8.5A2.75 2.75 0 0 1 2 13.25V2.5zm5.5.5a.75.75 0 0 0-1.5 0v6.823l-2.146-2.147a.75.75 0 1 0-1.06 1.06l3.5 3.5a.75.75 0 0 0 1.06 0l3.5-3.5a.75.75 0 1 0-1.06-1.06L7.5 9.823V3z"></path>
      </svg>
      <h3 class="repo-card-title">
        <a href="https://github.com/{{ include.repository }}" class="repo-link" rel="external nofollow noopener" target="_blank">
          {{ repo_name }}
        </a>
      </h3>
    </div>
    {% if repo_owner != 'act-compiler' %}
      <span class="repo-owner">{{ repo_owner }}</span>
    {% endif %}
  </div>

  <p class="repo-card-description">
    Open source repository on GitHub
  </p>

  <div class="repo-card-stats" id="stats-{{ include.repository | replace: '/', '-' }}">
    <div class="repo-stat placeholder">
      <svg class="stat-icon" viewBox="0 0 16 16" width="1em" height="1em" fill="currentColor">
        <path d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.147.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.714 1.952a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.146-.611L7.327.668A.75.75 0 018 .25z"></path>
      </svg>
      <span class="stat-label">-</span>
    </div>
    <div class="repo-stat placeholder">
      <svg class="stat-icon" viewBox="0 0 16 16" width="1em" height="1em" fill="currentColor">
        <path d="M5 3.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm0 2.5a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm6-2.5a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm0 2.5a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zM11 8a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm0 2.5a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"></path>
      </svg>
      <span class="stat-label">-</span>
    </div>
    <div class="repo-stat placeholder">
      <svg class="stat-icon" viewBox="0 0 16 16" width="1em" height="1em" fill="currentColor">
        <path d="M8 9.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path>
        <path fill-rule="evenodd" d="M8 0a8 8 0 100 16A8 8 0 008 0zM1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0z"></path>
      </svg>
      <span class="stat-label">-</span>
    </div>
  </div>

  <div class="repo-card-footer">
    <a href="https://github.com/{{ include.repository }}" class="repo-link-footer" rel="external nofollow noopener" target="_blank">
      View on GitHub â†’
    </a>
  </div>
</div>

<script>
(function() {
  const repoId = '{{ include.repository | replace: '/', '-' }}';
  const statsContainer = document.getElementById('stats-' + repoId);
  
  if (!statsContainer) return;
  
  // Fetch repository data from GitHub API
  fetch('https://api.github.com/repos/{{ include.repository }}', {
    headers: {
      'Accept': 'application/vnd.github.v3+json'
      {% if site.data.repositories.github_token %},
      'Authorization': 'token {{ site.data.repositories.github_token }}'
      {% endif %}
    }
  })
  .then(response => {
    if (!response.ok) {
      console.warn('Failed to fetch GitHub data for {{ include.repository }}');
      return null;
    }
    return response.json();
  })
  .then(data => {
    if (!data) return;
    
    // Create stats HTML
    let statsHTML = '';
    
    if (data.stargazers_count !== undefined) {
      statsHTML += `
        <div class="repo-stat">
          <svg class="stat-icon" viewBox="0 0 16 16" width="1em" height="1em" fill="currentColor">
            <path d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.147.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.714 1.952a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.146-.611L7.327.668A.75.75 0 018 .25z"></path>
          </svg>
          <span class="stat-label">${data.stargazers_count}</span>
        </div>
      `;
    }
    
    if (data.forks_count !== undefined) {
      statsHTML += `
        <div class="repo-stat">
          <svg class="stat-icon" viewBox="0 0 16 16" width="1em" height="1em" fill="currentColor">
            <path d="M5 3.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm0 2.5a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm6-2.5a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm0 2.5a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zM11 8a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm0 2.5a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"></path>
          </svg>
          <span class="stat-label">${data.forks_count}</span>
        </div>
      `;
    }
    
    if (data.open_issues_count !== undefined) {
      statsHTML += `
        <div class="repo-stat">
          <svg class="stat-icon" viewBox="0 0 16 16" width="1em" height="1em" fill="currentColor">
            <path d="M8 9.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path>
            <path fill-rule="evenodd" d="M8 0a8 8 0 100 16A8 8 0 008 0zM1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0z"></path>
          </svg>
          <span class="stat-label">${data.open_issues_count}</span>
        </div>
      `;
    }
    
    // Add language badge if available
    let languageHTML = '';
    if (data.language) {
      const card = statsContainer.closest('.repo-card');
      const langContainer = card.querySelector('.repo-card-language');
      if (!langContainer) {
        const newLangDiv = document.createElement('div');
        newLangDiv.className = 'repo-card-language';
        newLangDiv.innerHTML = `<span class="language-badge">${data.language}</span>`;
        card.insertBefore(newLangDiv, card.querySelector('.repo-card-footer'));
      }
    }
    
    // Replace placeholder stats with actual data
    statsContainer.innerHTML = statsHTML;
  })
  .catch(error => {
    console.warn('Error fetching GitHub data for {{ include.repository }}:', error);
  });
})();
</script>

<style>
.repo-card {
  display: flex;
  flex-direction: column;
  padding: 16px;
  margin: 8px;
  min-width: 280px;
  max-width: 340px;
  border: 1px solid var(--global-divider-color);
  border-radius: 8px;
  background-color: var(--global-bg-color);
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  position: relative;
  overflow: hidden;
}

.repo-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--global-theme-color), transparent);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.repo-card:hover {
  border-color: var(--global-theme-color);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  transform: translateY(-4px);
}

.repo-card:hover::before {
  opacity: 1;
}

.repo-card-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 12px;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--global-divider-color);
}

.repo-card-title-wrapper {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
}

.repo-icon {
  color: var(--global-theme-color);
  flex-shrink: 0;
  transition: transform 0.3s ease;
}

.repo-card:hover .repo-icon {
  transform: scale(1.1);
}

.repo-card-title {
  margin: 0;
  font-size: 1.1rem;
  font-weight: 600;
  line-height: 1.3;
}

.repo-link {
  color: var(--global-theme-color);
  text-decoration: none;
  transition: all 0.2s ease;
}

.repo-link:hover {
  color: var(--global-theme-color);
  text-decoration: underline;
  opacity: 0.8;
}

.repo-owner {
  font-size: 0.75rem;
  color: var(--global-text-color-secondary);
  background-color: var(--global-bg-color-light);
  padding: 4px 8px;
  border-radius: 4px;
  white-space: nowrap;
  flex-shrink: 0;
}

.repo-card-description {
  font-size: 0.9rem;
  color: var(--global-text-color-secondary);
  margin: 0 0 12px 0;
  line-height: 1.5;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.repo-card-stats {
  display: flex;
  gap: 8px;
  margin: 12px 0;
  padding: 12px 0;
  border-top: 1px solid var(--global-divider-color);
  border-bottom: 1px solid var(--global-divider-color);
  flex-wrap: wrap;
  min-height: 32px;
}

.repo-stat {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 0.85rem;
  color: var(--global-text-color-secondary);
  padding: 4px 6px;
  border-radius: 4px;
  background-color: var(--global-bg-color-light);
  transition: all 0.2s ease;
}

.repo-stat:hover {
  background-color: var(--global-divider-color);
  color: var(--global-text-color);
}

.repo-stat.placeholder {
  background-color: rgba(0, 0, 0, 0.1);
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% {
    opacity: 0.6;
  }
  50% {
    opacity: 0.3;
  }
}

.stat-icon {
  color: var(--global-theme-color);
  opacity: 0.8;
}

.stat-label {
  font-weight: 500;
}

.repo-card-language {
  margin: 8px 0;
  display: flex;
  gap: 6px;
}

.language-badge {
  display: inline-flex;
  align-items: center;
  font-size: 0.8rem;
  padding: 3px 8px;
  border-radius: 12px;
  background-color: var(--global-theme-color);
  color: white;
  font-weight: 500;
  white-space: nowrap;
}

.repo-card-footer {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid var(--global-divider-color);
}

.repo-link-footer {
  font-size: 0.85rem;
  color: var(--global-theme-color);
  text-decoration: none;
  font-weight: 500;
  transition: all 0.2s ease;
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.repo-link-footer:hover {
  gap: 8px;
  text-decoration: underline;
}

@media (prefers-color-scheme: dark) {
  .repo-card {
    border-color: #404040;
  }

  .repo-card:hover {
    border-color: var(--global-theme-color);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
  }

  .repo-owner {
    background-color: rgba(255, 255, 255, 0.05);
  }

  .repo-stat {
    background-color: rgba(255, 255, 255, 0.05);
  }

  .repo-stat:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }

  .repo-stat.placeholder {
    background-color: rgba(255, 255, 255, 0.1);
  }
}

@media (max-width: 576px) {
  .repo-card {
    min-width: 100%;
    max-width: 100%;
    margin: 8px 0;
  }

  .repo-card-title {
    font-size: 1rem;
  }

  .repo-card-stats {
    flex-direction: column;
  }

  .repo-stat {
    flex: 1;
    justify-content: space-between;
  }
}
</style>
